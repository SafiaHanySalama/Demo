/******************************************************************************
*
* Module: 
*
* File Name: uart_test.c
*

* Description: 
*
* Author: Safia Hany
* 
* Date:  13/4/2024
******************************************************************************/


/********************************************************************************************************/
/************************************************Includes************************************************/
/********************************************************************************************************/

#include "mcal/uart.h"
#include "mcal/gpio.h"
#include "mcal/nvic.h"
#include "hal/Clk_ctrl.h"
#include "app/app.h"

/********************************************************************************************************/
/************************************************Defines*************************************************/
/********************************************************************************************************/



/********************************************************************************************************/
/************************************************Types***************************************************/
/********************************************************************************************************/



/********************************************************************************************************/
/************************************************Variables***********************************************/
/********************************************************************************************************/



/********************************************************************************************************/
/*****************************************Static Functions Prototype*************************************/
/********************************************************************************************************/



/********************************************************************************************************/
/*********************************************APIs Implementation****************************************/
/********************************************************************************************************/

void uart_test()
{
    uint8 first = 'A';
    uint8 second[5] = "Safia";
    GPIO_ConfigPin_t uart_pins_config[2] = {
        {
            .Mode = GPIO_MODE_AF_PP,
            .Pin = PIN9,
            .Port = GPIO_PORTA,
            .Speed = GPIO_HIGH_SPEED
        },
        {
            .Mode = GPIO_MODE_AF_PP,
            .Pin = PIN10,
            .Port = GPIO_PORTA,
            .Speed = GPIO_HIGH_SPEED
        }
    };
    UART_UserReq_t uart_req1 = {
        .usartID = USART1_IDX,
        .ptr_buffer = &first,
        .size = 1,
        .cbf = NULL_PTR
    };
    UART_UserReq_t uart_req2 = {
        .usartID = USART1_IDX,
        .ptr_buffer = second,
        .size = 5,
        .cbf = NULL_PTR
    };
    set_preipheral_clk(USART1);
    set_preipheral_clk(GPIOA);
    //uint32 priority = NVIC_EncodePriority(PRIGROUP_1,0,0);
    //NVIC_SetPriority(USART1_IRQn,priority);
    NVIC_EnableIRQ(USART1_IRQn);

    GPIO_CFG_AlternativeFunction(uart_pins_config[0].Port,uart_pins_config[0].Pin,GPIO_AF_7);
    GPIO_CFG_AlternativeFunction(uart_pins_config[1].Port,uart_pins_config[1].Pin,GPIO_AF_7);
    GPIO_init(&uart_pins_config[0]);
    GPIO_init(&uart_pins_config[1]);
    UART_init();
    UART_sendByte(&uart_req1);
    USART_TxBufferAsyncZeroCopy(&uart_req2);
    while(1)
    {

    }

}
