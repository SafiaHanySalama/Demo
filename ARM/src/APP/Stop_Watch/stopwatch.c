/******************************************************************************
*
* Module: 
*
* File Name: stopwatch.c
*

* Description: 
*
* Author: Team7
* 
* Date:  16/4/2024
******************************************************************************/


/********************************************************************************************************/
/************************************************Includes************************************************/
/********************************************************************************************************/

#include "app/demo.h"

/********************************************************************************************************/
/************************************************Defines*************************************************/
/********************************************************************************************************/



/********************************************************************************************************/
/************************************************Types***************************************************/
/********************************************************************************************************/



/********************************************************************************************************/
/************************************************Variables***********************************************/
/********************************************************************************************************/

extern uint8 running; // Start the stopwatch immediately

extern uint8 paused;

extern uint8 reset;

extern CustomTime sw;

/********************************************************************************************************/
/*****************************************Static Functions Prototype*************************************/
/********************************************************************************************************/


 static void displayStopwatch(const CustomTime *sw) ;

 static void updateStopwatch(CustomTime *sw) ;

 static void resetStopwatch(CustomTime *sw) ;

 static void pauseStopwatch(char *paused);


/********************************************************************************************************/
/*********************************************APIs Implementation****************************************/
/********************************************************************************************************/

void MCU1_StopWatch(void)
 {

 /* Start , End , Puase , Reset */
      if (running)
     {
        if (!paused)
         {
             updateStopwatch(&sw);
        }
        else if (reset)
        {
        	resetStopwatch(&sw);
        }
        else
        {

        }
         displayStopwatch(&sw);
     }
      else
      {

      }
 }


static void resetStopwatch(CustomTime *sw) {
     sw->hours = 0;
     sw->minutes = 0;
     sw->seconds = 0;
 }

static void updateStopwatch(CustomTime *sw) {
     sw->seconds++;
     if (sw->seconds > 60) {
         sw->seconds = 0;
         sw->minutes++;
         if (sw->minutes > 60) {
             sw->minutes = 0;
             sw->hours++;
         }
     }
 }

static void displayStopwatch(const CustomTime *sw) {

    uint8 Buffer3[SIZE_BUFFER3];

    sprintf(Buffer3,"\rStopwatch: %02d:%02d:%02d", sw->hours, sw->minutes, sw->seconds);

    LCD_setCursorPosAsync(START_X_POSITION,START_Y_POSITION);

    LCD_writeStringAsync(&Buffer3,SIZE_BUFFER3);

 }


static void pauseStopwatch(char *paused) {
    *paused = !(*paused); // Toggle paused state
 }

